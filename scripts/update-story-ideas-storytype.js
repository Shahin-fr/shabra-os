const { PrismaClient } = require('@prisma/client');
const prisma = new PrismaClient();

// Map existing ideas to their appropriate story types
const ideaStoryTypeMapping = {
  // ØªØ¹Ø§Ù…Ù„ Ø¨Ø§ Ù…Ø®Ø§Ø·Ø¨
  'Ù†Ø¸Ø±Ø³Ù†Ø¬ÛŒ Ø§Ø² Ù…Ø®Ø§Ø·Ø¨Ø§Ù†': 'ØªØ¹Ø§Ù…Ù„ Ø¨Ø§ Ù…Ø®Ø§Ø·Ø¨',
  'Ø³ÙˆØ§Ù„ Ùˆ Ø¬ÙˆØ§Ø¨ Ø¨Ø§ Ù…Ø®Ø§Ø·Ø¨Ø§Ù†': 'ØªØ¹Ø§Ù…Ù„ Ø¨Ø§ Ù…Ø®Ø§Ø·Ø¨',
  'Ú†Ø§Ù„Ø´ Ø±ÙˆØ²Ø§Ù†Ù‡': 'ØªØ¹Ø§Ù…Ù„ Ø¨Ø§ Ù…Ø®Ø§Ø·Ø¨',
  'Ù†Ø¸Ø±Ø®ÙˆØ§Ù‡ÛŒ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø­ØªÙˆØ§': 'ØªØ¹Ø§Ù…Ù„ Ø¨Ø§ Ù…Ø®Ø§Ø·Ø¨',
  'Ú©ÙˆØ¦ÛŒØ² Ùˆ Ù…Ø³Ø§Ø¨Ù‚Ù‡': 'ØªØ¹Ø§Ù…Ù„ Ø¨Ø§ Ù…Ø®Ø§Ø·Ø¨',
  'Ù†Ø¸Ø±Ø®ÙˆØ§Ù‡ÛŒ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø­ØµÙˆÙ„': 'ØªØ¹Ø§Ù…Ù„ Ø¨Ø§ Ù…Ø®Ø§Ø·Ø¨',
  'Ù†Ø¸Ø±Ø®ÙˆØ§Ù‡ÛŒ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø®Ø¯Ù…Ø§Øª': 'ØªØ¹Ø§Ù…Ù„ Ø¨Ø§ Ù…Ø®Ø§Ø·Ø¨',

  // Ù…Ø¹Ø±ÙÛŒ Ù…Ø­ØµÙˆÙ„
  'Ù…Ø¹Ø±ÙÛŒ Ù…Ø­ØµÙˆÙ„ Ø¬Ø¯ÛŒØ¯': 'Ù…Ø¹Ø±ÙÛŒ Ù…Ø­ØµÙˆÙ„',
  'ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ú©Ù„ÛŒØ¯ÛŒ Ù…Ø­ØµÙˆÙ„': 'Ù…Ø¹Ø±ÙÛŒ Ù…Ø­ØµÙˆÙ„',
  'Ù…Ù‚Ø§ÛŒØ³Ù‡ Ù…Ø­ØµÙˆÙ„Ø§Øª': 'Ù…Ø¹Ø±ÙÛŒ Ù…Ø­ØµÙˆÙ„',
  'Ù†Ø­ÙˆÙ‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù…Ø­ØµÙˆÙ„': 'Ù…Ø¹Ø±ÙÛŒ Ù…Ø­ØµÙˆÙ„',
  'Ù…Ø²Ø§ÛŒØ§ÛŒ Ù…Ø­ØµÙˆÙ„': 'Ù…Ø¹Ø±ÙÛŒ Ù…Ø­ØµÙˆÙ„',

  // Ø¢Ù…ÙˆØ²Ø´ÛŒ
  'Ù†Ú©Ø§Øª Ø¢Ù…ÙˆØ²Ø´ÛŒ': 'Ø¢Ù…ÙˆØ²Ø´ÛŒ',
  'Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ú¯Ø§Ù… Ø¨Ù‡ Ú¯Ø§Ù…': 'Ø¢Ù…ÙˆØ²Ø´ÛŒ',
  'Ø§Ø´ØªØ¨Ø§Ù‡Ø§Øª Ø±Ø§ÛŒØ¬': 'Ø¢Ù…ÙˆØ²Ø´ÛŒ',
  'Ø³ÙˆØ§Ù„Ø§Øª Ù…ØªØ¯Ø§ÙˆÙ„': 'Ø¢Ù…ÙˆØ²Ø´ÛŒ',
  'Ù†Ú©Ø§Øª Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ': 'Ø¢Ù…ÙˆØ²Ø´ÛŒ',
  'Ø¢Ù…ÙˆØ²Ø´ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø§Ø¨Ø²Ø§Ø±': 'Ø¢Ù…ÙˆØ²Ø´ÛŒ',

  // Ù¾Ø´Øª ØµØ­Ù†Ù‡
  'Ø±ÙˆØ² Ú©Ø§Ø±ÛŒ ØªÛŒÙ…': 'Ù¾Ø´Øª ØµØ­Ù†Ù‡',
  'ÙØ±Ø¢ÛŒÙ†Ø¯ ØªÙˆÙ„ÛŒØ¯': 'Ù¾Ø´Øª ØµØ­Ù†Ù‡',
  'Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±ÛŒ': 'Ù¾Ø´Øª ØµØ­Ù†Ù‡',
  'ØªÛŒÙ… Ùˆ Ù‡Ù…Ú©Ø§Ø±Ø§Ù†': 'Ù¾Ø´Øª ØµØ­Ù†Ù‡',
  'ÙØ¶Ø§ÛŒ Ú©Ø§Ø±ÛŒ': 'Ù¾Ø´Øª ØµØ­Ù†Ù‡',

  // ÙØ±ÙˆØ´ ÙˆÛŒÚ˜Ù‡
  'ØªØ®ÙÛŒÙ ÙˆÛŒÚ˜Ù‡': 'ÙØ±ÙˆØ´ ÙˆÛŒÚ˜Ù‡',
  'Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù…Ø­Ø¯ÙˆØ¯': 'ÙØ±ÙˆØ´ ÙˆÛŒÚ˜Ù‡',
  'Ú©Ø¯ ØªØ®ÙÛŒÙ': 'ÙØ±ÙˆØ´ ÙˆÛŒÚ˜Ù‡',

  // Ø³Ø±Ú¯Ø±Ù…ÛŒ
  'Ø¯Ø§Ø³ØªØ§Ù† Ø¨Ø±Ù†Ø¯': 'Ø³Ø±Ú¯Ø±Ù…ÛŒ',
  'Ù†Ú©Ø§Øª Ø¬Ø§Ù„Ø¨': 'Ø³Ø±Ú¯Ø±Ù…ÛŒ',
  'Ù…Ø¹Ù…Ø§ Ùˆ Ú†Ø§Ù„Ø´': 'Ø³Ø±Ú¯Ø±Ù…ÛŒ',

  // Ø§Ø®Ø¨Ø§Ø± Ùˆ Ø±ÙˆÛŒØ¯Ø§Ø¯
  'Ø§Ø±Ø²Ø´â€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ù†Ø¯': 'Ø§Ø®Ø¨Ø§Ø± Ùˆ Ø±ÙˆÛŒØ¯Ø§Ø¯',
  'Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ù…Ù‡Ù…': 'Ø§Ø®Ø¨Ø§Ø± Ùˆ Ø±ÙˆÛŒØ¯Ø§Ø¯',
  'Ø¯Ø³ØªØ§ÙˆØ±Ø¯Ù‡Ø§ÛŒ Ø´Ø±Ú©Øª': 'Ø§Ø®Ø¨Ø§Ø± Ùˆ Ø±ÙˆÛŒØ¯Ø§Ø¯',

  // Ø´Ø±ÙˆØ¹/Ù¾Ø§ÛŒØ§Ù† Ø±ÙˆØ²
  'Ø´Ø±ÙˆØ¹ Ø±ÙˆØ²': 'Ø´Ø±ÙˆØ¹/Ù¾Ø§ÛŒØ§Ù† Ø±ÙˆØ²',
  'Ù¾Ø§ÛŒØ§Ù† Ø±ÙˆØ²': 'Ø´Ø±ÙˆØ¹/Ù¾Ø§ÛŒØ§Ù† Ø±ÙˆØ²',
};

async function main() {
  console.log('ðŸ”„ Ø´Ø±ÙˆØ¹ Ø¨Ù‡ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø³ØªÙˆØ±ÛŒ...');

  try {
    // Get all existing story ideas
    const ideas = await prisma.storyIdea.findMany();
    console.log(`ðŸ“Š ${ideas.length} Ø§ÛŒØ¯Ù‡ Ù…ÙˆØ¬ÙˆØ¯ ÛŒØ§ÙØª Ø´Ø¯`);

    let updatedCount = 0;

    for (const idea of ideas) {
      const newStoryType = ideaStoryTypeMapping[idea.title];

      if (newStoryType) {
        await prisma.storyIdea.update({
          where: { id: idea.id },
          data: { storyType: newStoryType },
        });
        console.log(`âœ… ${idea.title} -> ${newStoryType}`);
        updatedCount++;
      } else {
        console.log(`âš ï¸  ${idea.title} -> Ø¨Ø¯ÙˆÙ† ØªØ·Ø¨ÛŒÙ‚ (Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù¾ÛŒØ´â€ŒÙØ±Ø¶)`);
      }
    }

    console.log(`\nðŸŽ‰ ${updatedCount} Ø§ÛŒØ¯Ù‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯Ù†Ø¯`);

    // Show summary by story type
    const summary = await prisma.storyIdea.groupBy({
      by: ['storyType'],
      _count: { storyType: true },
    });

    console.log('\nðŸ“ˆ Ø®Ù„Ø§ØµÙ‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙˆØ¹ Ø§Ø³ØªÙˆØ±ÛŒ:');
    summary.forEach(item => {
      console.log(`${item.storyType}: ${item._count.storyType} Ø§ÛŒØ¯Ù‡`);
    });
  } catch (error) {
    console.error('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§:', error);
    throw error;
  } finally {
    await prisma.$disconnect();
  }
}

main().catch(e => {
  console.error(e);
  process.exit(1);
});
